((function(){var a=Array.prototype.slice;window.BoneTree={},BoneTree.namespace=function(b,c,d){var e,f,g,h,i,j;arguments.length<3&&(i=[typeof exports!="undefined"?exports:window].concat(a.call(arguments)),b=i[0],c=i[1],d=i[2]),f=b,j=c.split(".");for(g=0,h=j.length;g<h;g++)e=j[g],b=b[e]||(b[e]={});return d(b,f)}})).call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};BoneTree.namespace("BoneTree",function(a){return a.View=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.initialize=function(){return this.settings=this.options.settings},c}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};BoneTree.namespace("BoneTree.Models",function(b){return b.Node=function(d){function e(){this.nameWithExtension=a(this.nameWithExtension,this),this.constantize=a(this.constantize,this),e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.initialize=function(){return this.collection=new b.Nodes},e.prototype.constantize=function(){var a;return a=this.get("nodeType"),a[0].toUpperCase()+a.slice(1,a.length+1||9e9)},e.prototype.nameWithExtension=function(){var a;return a=this.get("extension")?"."+this.get("extension"):"",this.get("name")+a},e}(Backbone.Model),b.Nodes=function(a){function d(){d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.comparator=function(a){var b,c;return b=a.get("name"),c=a.get("sortPriority"),c+b},d.prototype.model=b.Node,d}(Backbone.Collection)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};BoneTree.namespace("BoneTree.Models",function(b){return b.Directory=function(b){function d(){this.toggleOpen=a(this.toggleOpen,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.defaults={name:"New Directory",open:!1,sortPriority:"0",nodeType:"directory"},d.prototype.toggleOpen=function(){var a;return a=this.get("open"),this.set({open:!a})},d}(b.Node),b.Directory.find=function(a,b){return a.collection.find(function(a){return a.get("name")===b})}})}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;BoneTree.namespace("BoneTree.Models",function(a){return a.File=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.defaults={name:"New File",sortPriority:"1",nodeType:"file"},c}(a.Node),a.File.createFromFileName=function(b,d){var e,f,g,h,i,j;return j=b.split("."),h=2<=j.length?c.call(j,0,i=j.length-1):(i=0,[]),f=j[i++],g=h.join("."),e=_.extend({},d,{name:g,extension:f}),new a.File(e)}})}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};BoneTree.namespace("BoneTree.Models",function(a){return a.Settings=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.defaults={confirmDeletes:!1,showExtensions:!1,viewCache:{}},c}(Backbone.Model)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};BoneTree.namespace("BoneTree.Views",function(b){var d;return d=BoneTree.Models,b.Directory=function(b){function d(){this.displayChildren=a(this.displayChildren,this),this.toggleOpen=a(this.toggleOpen,this),this.render=a(this.render,this),this.appendView=a(this.appendView,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.className="directory",d.prototype.tagName="ul",d.prototype.initialize=function(){var a=this;return d.__super__.initialize.apply(this,arguments),this.$el.attr("data-cid",this.cid),this.model.bind("change:open",function(b,c){return a.displayChildren(c)}),this.model.bind("change:name",function(b,c){return a.settings.get("treeView").trigger("rename",b,c),a.settings.get("treeView").render()}),this.model.collection.bind("add",this.render),this.model.collection.bind("remove",function(b,c){return a.settings.get("treeView").trigger("remove",b),a.render()}),this.displayChildren(this.model.get("open"))},d.prototype.appendView=function(a){var b;return b=this.settings.get("treeView").findView(a),this.$el.append(b.render().$el)},d.prototype.render=function(){return this.$el.text(this.model.get("name")),this.model.collection.sort(),this.model.collection.each(this.appendView),this},d.prototype.toggleOpen=function(a){return this.model.toggleOpen()},d.prototype.displayChildren=function(a){var b;return b=this.$el.children(".directory, .file"),this.$el.toggleClass("open",a),b.toggle(a)},d}(BoneTree.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};BoneTree.namespace("BoneTree.Views",function(b){return b.File=function(b){function d(){this.render=a(this.render,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.className="file",d.prototype.tagName="li",d.prototype.initialize=function(){var a=this;return d.__super__.initialize.apply(this,arguments),this.$el.attr("data-cid",this.cid).addClass(this.model.get("extension")),this.model.bind("change:name",function(b,c){return a.settings.get("treeView").trigger("rename",b,b.nameWithExtension()),a.settings.get("treeView").render()}),this.model.bind("change:extension",function(b,c){return a.$el.attr("class","file "+c),a.settings.get("treeView").trigger("rename",b,b.nameWithExtension()),a.settings.get("treeView").render()})},d.prototype.render=function(){return this.settings.get("showExtensions")?this.$el.text(this.model.nameWithExtension()):this.$el.text(this.model.get("name")),this},d}(BoneTree.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};BoneTree.namespace("BoneTree.Views",function(b){return b.Menu=function(b){function d(){this.render=a(this.render,this),this.rename=a(this.rename,this),this["delete"]=a(this["delete"],this),this.contextMenu=a(this.contextMenu,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.className="menu",d.prototype.events={contextmenu:"contextMenu","click .rename":"rename","click .delete":"delete"},d.prototype.initialize=function(){return d.__super__.initialize.apply(this,arguments)},d.prototype.contextMenu=function(a){return a.preventDefault(),a.stopPropagation()},d.prototype["delete"]=function(a){return this.settings.get("confirmDeletes")?confirm("Are you sure you want to delete '"+this.model.nameWithExtension()+"'?")&&this.model.destroy():this.model.destroy(),this.$el.hide()},d.prototype.rename=function(a){var b,c,d,e;if(d=prompt("New Name",this.model.nameWithExtension()))e=d.split("."),c=e[0],b=e[1],b==null&&(b=""),this.model.set({name:c,extension:b});return this.$el.hide()},d.prototype.render=function(){return this.$el.html(this.htmlTemplate()),this},d.prototype.htmlTemplate=function(){return"<ul>\n  <li class='rename'>Rename</li>\n  <hr/>\n  <li class='delete'>Delete</li>\n</ul>"},d}(BoneTree.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=Array.prototype.slice;BoneTree.namespace("BoneTree.Views",function(b){var e;return e=BoneTree.Models,b.Tree=function(f){function g(){this.render=a(this.render,this),this.openFile=a(this.openFile,this),this.openDirectory=a(this.openDirectory,this),this.toAscii=a(this.toAscii,this),this.contextMenu=a(this.contextMenu,this),this.closeMenu=a(this.closeMenu,this),this.findView=a(this.findView,this),this.addToTree=a(this.addToTree,this),this.addFromJSON=a(this.addFromJSON,this),this.addFile=a(this.addFile,this),g.__super__.constructor.apply(this,arguments)}return c(g,f),g.prototype.className="tree",g.prototype.events={"contextmenu .file":"contextMenu","contextmenu .directory":"contextMenu","click .directory":"openDirectory","click .file":"openFile"},g.prototype.initialize=function(){var a=this;return g.__super__.initialize.apply(this,arguments),$(document).click(this.closeMenu),this.currentFileData=null,this.settings=new e.Settings({treeView:this,confirmDeletes:this.options.confirmDeletes,showExtensions:this.options.showExtensions}),this.menuView=new b.Menu({settings:this.settings}),this.menuView.render().$el.appendTo(this.$el),this.root=new e.Node,this.root.collection.bind("add",this.render),this.root.collection.bind("remove",function(b,c){return a.render(),a.settings.get("treeView").trigger("remove",b)})},g.prototype.addFile=function(a){var b,c,e,f;return a[0]==="/"&&(a=a.replace("/","")),f=a.split("/"),b=2<=f.length?d.call(f,0,e=f.length-1):(e=0,[]),c=f[e++],this.addToTree(this.root,b,c)},g.prototype.addFromJSON=function(a,b){var c,d,e,f,g,h;b==null&&(b=""),a.name!=null&&(d=a.name+"/",delete a.name),a.extension!=null&&(d=d.replace("/","."+a.extension),delete a.extension),b+=d;if(a.files!=null){g=a.files,h=[];for(e=0,f=g.length;e<f;e++)c=g[e],h.push(this.addFromJSON(c,b));return h}return this.currentFileData=a,this.addFile(b)},g.prototype.addToTree=function(a,b,c){var d,f,g,h,i;if(b.length)return i=b.shift(),(f=e.Directory.find(a,i))?(f.set({open:!0}),this.addToTree(f,b,c)):(h=new e.Directory({name:i,open:!0}),g=a.collection.add(h),this.addToTree(h,b,c));if(c==="")return;return d=e.File.createFromFileName(c,this.currentFileData),this.currentFileData=null,a.collection.add(d)},g.prototype.findView=function(a){var c,d,e;return c=a.constantize(),e=this.settings.get("viewCache"),(d=e[a.cid])||(d=e[a.cid]=new b[c]({model:a,settings:this.settings})),d},g.prototype.cacheFindByViewCid=function(a){var b,c,d;d=this.settings.get("viewCache");for(b in d){c=d[b];if(a===c.cid)return c}},g.prototype.closeMenu=function(a){if(!$(a.currentTarget).is(".menu"))return this.menuView.$el.hide()},g.prototype.contextMenu=function(a){var b,c,d;return a.preventDefault(),a.stopPropagation(),c=$(a.currentTarget),b=c.data("cid"),d=this.cacheFindByViewCid(b),this.menuView.model=d.model,this.menuView.$el.css({left:a.pageX+this.$el.parent().scrollLeft(),top:a.pageY+this.$el.parent().scrollTop()}).show()},g.prototype.toAscii=function(a,b,c){var d,e,f,g=this;b==null&&(b=0),c==null&&(c="\n"),e=a||this.root.collection,f="";for(d=0;0<=b?d<=b:d>=b;0<=b?d++:d--)f+=" ";return e.each(function(a){var d;return d=a.get("type")==="directory"?"+":"-",c+=f+d+a.nameWithExtension()+"\n",c=g.toAscii(a.collection,b+1,c)}),c},g.prototype.openDirectory=function(a){var b,c;return a.stopPropagation(),this.menuView.$el.hide(),b=$(a.currentTarget).data("cid"),c=this.cacheFindByViewCid(b),c.toggleOpen()},g.prototype.openFile=function(a){var b,c;return a.stopPropagation(),this.menuView.$el.hide(),b=$(a.currentTarget).data("cid"),c=this.cacheFindByViewCid(b),this.trigger("openFile",c.model)},g.prototype.render=function(){var a=this;return this.root.collection.sort(),this.root.collection.each(function(b){var c;return b.collection.sort(),c=a.findView(b),a.$el.append(c.render().$el)}),this},g}(BoneTree.View)})}.call(this),function(){}.call(this)